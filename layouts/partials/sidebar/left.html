<aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        <figure class="site-avatar">
            {{ $avatar := .Site.Params.sidebar.avatar }}
            {{ if $avatar.enabled }}
            <a href="javascript:void(0)" class="avatar-link" data-avatar="{{ $avatar.src | relURL }}">
                {{ if $avatar.local }}
                    <img src="{{ $avatar.src | relURL }}" width="300" height="300" class="site-logo" loading="lazy" alt="Avatar" />
                {{ else }}
                    <img src="{{ $avatar.src }}" width="300" height="300" class="site-logo" loading="lazy" alt="Avatar" />
                {{ end }}
            </a>
            {{ end }}
            {{ with $.Site.Params.sidebar.emoji }}
            <span class="emoji">{{ . }}</span>
            {{ end }}
        </figure>

        <div class="site-meta">
            <h1 class="site-name"><a href="{{ .Site.BaseURL | relLangURL }}">{{ .Site.Title }}</a></h1>
            <h2 class="site-description">{{ .Site.Params.sidebar.subtitle }}</h2>
        </div>
    </header>

    {{- with .Site.Menus.social -}}
    <ol class="menu-social">
        {{ range . }}
        <li>
            <a href='{{ .URL }}' {{ if eq (default true .Params.newTab) true }}target="_blank" {{ end }} {{ with .Name }}title="{{ . }}" {{ end }} rel="me">
                {{ $icon := default "link" .Params.Icon }}
                {{ with $icon }}
                {{ partial "helper/icon" . }}
                {{ end }}
            </a>
        </li>
        {{ end }}
    </ol>
    {{- end -}}

    <ol class="menu" id="main-menu">
        {{ $currentPage := . }}
        {{ range .Site.Menus.main }}
        {{ $active := or (eq $currentPage.RelPermalink .URL) (or ($currentPage.HasMenuCurrent "main" .) ($currentPage.IsMenuCurrent "main" .)) }}
        <li {{ if $active }} class='current' {{ end }}>
            <a href='{{ .URL }}' {{ if eq .Params.newTab true }}target="_blank" {{ end }}>
                {{ $icon := default .Pre .Params.Icon }}
                {{ with $icon }}
                {{ partial "helper/icon" . }}
                {{ end }}
                <span>{{- .Name -}}</span>
            </a>
        </li>
        {{ end }}
    </ol>

    <div class="sidebar-bottom-controls">
        {{- $currentLanguageCode := .Language.Lang -}}
        {{ if ( compare.Gt .Site.Home.AllTranslations.Len 1 ) }}
        <div id="lang-switch">
            {{ partial "helper/icon" "language" }}
            {{ range .Translations }}
            <a href="{{ .RelPermalink }}" class="lang-link">
                {{ if eq .Language.Lang "zh-cn" }}
                    切换到中文
                {{ else if eq .Language.Lang "en" }}
                    Switch to English
                {{ else }}
                    {{ .Language.LanguageName }}
                {{ end }}
            </a>
            {{ end }}
        </div>
        {{ end }}

        {{ if (default false .Site.Params.colorScheme.toggle) }}
        <div id="dark-mode-toggle">
            {{ partial "helper/icon" "toggle-left" }}
            {{ partial "helper/icon" "toggle-right" }}
            <span>{{ T "darkMode" }}</span>
        </div>
        {{ end }}
    </div>
</aside>

<!-- 头像弹出层 -->
<div id="avatar-modal" class="avatar-modal">
    <div class="avatar-modal-overlay"></div>
    <div class="avatar-modal-content">
        <img src="" alt="Avatar" class="avatar-modal-img">
    </div>
</div>

<script>
    (function () {
        const avatarLink = document.querySelector('.avatar-link');
        const modal = document.getElementById('avatar-modal');
        
        if (!avatarLink || !modal) return;
        
        const modalImg = modal.querySelector('.avatar-modal-img');
        const overlay = modal.querySelector('.avatar-modal-overlay');

        function openModal(e) {
            e.preventDefault();
            const avatarSrc = avatarLink.getAttribute('data-avatar');
            modalImg.src = avatarSrc;
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        avatarLink.addEventListener('click', openModal);
        overlay.addEventListener('click', closeModal);
        modal.querySelector('.avatar-modal-content').addEventListener('click', closeModal);

        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
                closeModal();
            }
        });
    })();
</script>
<aside class="sidebar left-sidebar sticky {{ if .Site.Params.sidebar.compact }}compact{{ end }}">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="{{ T `toggleMenu` }}">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        {{ with .Site.Params.sidebar.avatar }}
        {{ if (default true .enabled) }}
        <figure class="site-avatar">
            {{- $avatarSrc := "" -}}
            {{ if not .local }}
            {{- $avatarSrc = .src -}}
            <a href="javascript:void(0)" class="avatar-link" data-avatar="{{ .src }}">
                <img src="{{ .src }}" width="300" height="300" class="site-logo" loading="lazy" alt="Avatar">
            </a>
            {{ else }}
            {{ $avatar := resources.Get (.src) }}

            {{ if $avatar }}
            {{ $avatarResized := $avatar.Resize "300x" }}
            {{- $avatarSrc = $avatar.RelPermalink -}}
            <a href="javascript:void(0)" class="avatar-link" data-avatar="{{ $avatar.RelPermalink }}">
                <img src="{{ $avatarResized.RelPermalink }}" width="{{ $avatarResized.Width }}"
                    height="{{ $avatarResized.Height }}" class="site-logo" loading="lazy" alt="Avatar">
            </a>
            {{ else }}
            {{ errorf "Failed loading avatar from %q" . }}
            {{ end }}
            {{ end }}
            {{ with $.Site.Params.sidebar.emoji }}
            <span class="emoji">{{ . }}</span>
            {{ end }}
        </figure>
        {{ end }}
        {{ end }}

        <div class="site-meta">
            <h1 class="site-name"><a href="{{ .Site.BaseURL | relLangURL }}">{{ .Site.Title }}</a></h1>
            <h2 class="site-description">{{ .Site.Params.sidebar.subtitle }}</h2>
        </div>
    </header>

    {{- with .Site.Menus.social -}}
    <ol class="menu-social">
        {{ range . }}
        <li>
            <a href='{{ .URL }}' {{ if eq (default true .Params.newTab) true }}target="_blank" {{ end }} {{ with .Name
                }}title="{{ . }}" {{ end }} rel="me">
                {{ $icon := default "link" .Params.Icon }}
                {{ with $icon }}
                {{ partial "helper/icon" . }}
                {{ end }}
            </a>
        </li>
        {{ end }}
    </ol>
    {{- end -}}

    <ol class="menu" id="main-menu">
        {{ $currentPage := . }}
        {{ range .Site.Menus.main }}
        {{ $active := or (eq $currentPage.RelPermalink .URL) (or ($currentPage.HasMenuCurrent "main" .)
        ($currentPage.IsMenuCurrent "main" .)) }}
        <li {{ if $active }} class='current' {{ end }}>
            <a href='{{ .URL }}' {{ if eq .Params.newTab true }}target="_blank" {{ end }}>
                {{ $icon := default .Pre .Params.Icon }}
                {{ if .Pre }}
                {{ warnf `Menu item [%s] is using [pre] field to set icon, please use [params.icon] instead. More
                information: https://stack.jimmycai.com/config/menu` .URL }}
                {{ end }}
                {{ with $icon }}
                {{ partial "helper/icon" . }}
                {{ end }}
                <span>{{- .Name -}}</span>
            </a>
        </li>
        {{ end }}
    </ol>

    <div class="sidebar-bottom-controls">
        {{- $currentLanguageCode := .Language.Lang -}}
        {{ if ( compare.Gt .Site.Home.AllTranslations.Len 1 ) }}
        <div id="lang-switch">
            {{ partial "helper/icon" "language" }}
            {{ range .Site.Home.AllTranslations }}
            {{ if ne .Language.Lang $currentLanguageCode }}
            <a href="{{ .Permalink }}" class="lang-link">
                {{ T "selectLanguage" }}
            </a>
            {{ end }}
            {{ end }}
        </div>
        {{ end }}

        {{ if (default false .Site.Params.colorScheme.toggle) }}
        <div id="dark-mode-toggle">
            {{ partial "helper/icon" "toggle-left" }}
            {{ partial "helper/icon" "toggle-right" }}
            <span>{{ T "darkMode" }}</span>
        </div>
        {{ end }}
    </div>
</aside>

<!-- 头像弹出层 -->
<div id="avatar-modal" class="avatar-modal">
    <div class="avatar-modal-overlay"></div>
    <div class="avatar-modal-content">
        <img src="" alt="Avatar" class="avatar-modal-img">
    </div>
</div>

<script>
    (function () {
        const avatarLink = document.querySelector('.avatar-link');
        const modal = document.getElementById('avatar-modal');
        const modalImg = modal.querySelector('.avatar-modal-img');
        const overlay = modal.querySelector('.avatar-modal-overlay');

        if (avatarLink && modal) {
            avatarLink.addEventListener('click', function (e) {
                e.preventDefault();
                const avatarSrc = this.getAttribute('data-avatar');
                modalImg.src = avatarSrc;
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            });

            function closeModal() {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }

            overlay.addEventListener('click', closeModal);
            modal.querySelector('.avatar-modal-content').addEventListener('click', closeModal);

            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && modal.classList.contains('active')) {
                    closeModal();
                }
            });
        }
    })();
</script>